<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Pure Schedule – 2026 (HOL Fix + Visible Holidays)</title>

<style>
:root{
  --grid:#6a6a6a;

  --hdr9:#1a1a1a;   /* header rows */
  --sun7:#4d4d4d;   /* Sunday column */
  --sat5:#7a7a7a;   /* Saturday column */
  --wk:#f6f6f6;     /* weekday base */

  --row2:#e6e6e6;
  --row1:#f0f0f0;

  --holiday:#b30000;
  --select:#fff3a0; /* yellow row highlight */
}

body{ margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial; background:#fff; }

header{
  position:sticky; top:0; z-index:20;
  background:#fff;
  border-bottom:2px solid var(--grid);
  padding:8px;
}

.controls{
  display:flex; gap:8px; flex-wrap:wrap; align-items:center;
}

select,input,button{
  padding:6px 8px;
  font-size:14px;
  border:2px solid var(--grid);
  border-radius:8px;
  background:#fff;
}
button{ cursor:pointer }

.wrap{ padding:8px; }

.panel{
  border:2px solid var(--grid);
  border-radius:10px;
  margin-bottom:12px;
  overflow:hidden;
}

.monthHeader{
  background:var(--hdr9);
  color:#fff;
  padding:8px 12px;
  font-weight:900;
  text-transform:uppercase;
  font-size:14px;
}

.scroll{ overflow-x:auto; -webkit-overflow-scrolling:touch; }

table{
  border-collapse:collapse;
  font-family:ui-monospace,Menlo,Consolas,monospace;
  font-size:12px;
  width:max-content;
  min-width:100%;
}

th,td{
  border:1px solid var(--grid);
  text-align:center;
  padding:0;
  height:28px;
  min-width:34px;
  font-weight:900;
}

/* sticky NAME */
th.name, td.name{
  position:sticky;
  left:0;
  z-index:6;
  text-align:left;
  padding:0 8px;
  min-width:190px;
  font-family:system-ui;
  cursor:pointer;
}

/* column colors */
.wkCol{ background:var(--wk) !important; color:#111; }
.satCol{ background:var(--sat5) !important; color:#111; }
.sunCol{ background:var(--sun7) !important; color:#fff; }

/* row striping – weekday cells only */
tr.r2 td.wkCol{ background:var(--row2) !important; }
tr.r1 td.wkCol{ background:var(--row1) !important; }
tr.r2 td.name{ background:var(--row2) !important; }
tr.r1 td.name{ background:var(--row1) !important; }

/* header rows */
tr.hdrRow th{
  background:var(--hdr9) !important;
  color:#fff !important;
}
tr.hdrRow th.name{ background:var(--hdr9) !important; }

/* HOL cell */
td.hol{ color:var(--holiday) !important; font-weight:1000; }

/* header HOL marker */
th.holHead{
  color: var(--holiday) !important;
  background: var(--hdr9) !important;
  font-weight:1000;
}

/* SELECTED ROW (overrides striping + weekend colors) */
tr.selected td.wkCol,
tr.selected td.satCol,
tr.selected td.sunCol,
tr.selected td.name{
  background: var(--select) !important;
  color:#000 !important;
}
/* keep HOL red even when selected */
tr.selected td.hol{
  color: var(--holiday) !important;
}

@media (max-width:700px){
  th.name, td.name{ min-width:150px; }
  table{ font-size:11px; }
}
</style>
</head>

<body>
<header>
  <div class="controls">
    <label>Start Month <input id="startMonth" type="month"></label>
    <label>Show Months
      <select id="showMonths">
        <option value="3">3</option>
        <option value="4">4</option>
      </select>
    </label>
    <button id="prev">◀</button>
    <button id="next">▶</button>
    <button id="today">This Month</button>
  </div>
</header>

<div class="wrap" id="wrap"></div>

<script>
/* ================= BASE DATA ================= */

const LOOP = 42;

const SLOTS = {
1:["R","R","RDO","RDO","RDO","MDO","C","C/A","C","C","C","C","RDO","RDO","B","B","B","B","B","B","RDO","RDO","A","A","A","A","A/C","A","MDO","RDO","RDO","RDO","B","B","B","B","B","RDO","RDO","R","R","R"],
2:["C/A","C","C","C","C","RDO","RDO","B","B","B","B","B","B","RDO","RDO","A","A","A","A","A/C","A","MDO","RDO","RDO","RDO","B","B","B","B","B","RDO","RDO","R","R","R","R","R","RDO","RDO","RDO","MDO","C"],
3:["B","B","B","B","B","B","RDO","RDO","A","A","A","A","A/C","A","MDO","RDO","RDO","RDO","B","B","B","B","B","RDO","RDO","R","R","R","R","R","RDO","RDO","RDO","MDO","C","C/A","C","C","C","C","RDO","RDO"],
4:["RDO","A","A","A","A","A/C","A","MDO","RDO","RDO","RDO","B","B","B","B","B","RDO","RDO","R","R","R","R","R","RDO","RDO","RDO","MDO","C","C/A","C","C","C","C","RDO","RDO","B","B","B","B","B","B","RDO"],
5:["MDO","RDO","RDO","RDO","B","B","B","B","B","RDO","RDO","R","R","R","R","R","RDO","RDO","RDO","MDO","C","C/A","C","C","C","C","RDO","RDO","B","B","B","B","B","B","RDO","RDO","A","A","A","A","A/C","A"],
6:["B","B","RDO","RDO","R","R","R","R","R","RDO","RDO","RDO","MDO","C","C/A","C","C","C","C","RDO","RDO","B","B","B","B","B","B","RDO","RDO","A","A","A","A","A/C","A","MDO","RDO","RDO","RDO","B","B","B"]
};

const PEOPLE=[
 {n:"Kingston, Joseph C.",s:1},
 {n:"Rodriguez, Roger",s:1},
 {n:"Joseph, George R",s:2},
 {n:"Ramnarine, Ashram",s:2},
 {n:"Segovia, Eduardo M",s:3},
 {n:"Victoria, Robert",s:3},
 {n:"Bouaziz, Abdelghani",s:4},
 {n:"Gragossian, Alan",s:4},
 {n:"Handel, Joseph",s:5},
 {n:"Rakhmanov, Ravshan",s:5},
 {n:"Rodriguez, Alexander",s:6},
 {n:"Svenjak, Mark",s:6}
];

/* ===== FINAL HOLIDAYS – 2026 ===== */
const HOLIDAYS_2026 = new Set([
  "2026-01-01",
  "2026-01-19",
  "2026-02-16",
  "2026-05-25",
  "2026-06-19",
  "2026-07-03",
  "2026-07-06",
  "2026-09-07",
  "2026-10-12",
  "2026-11-11",
  "2026-11-26",
  "2026-11-27",
  "2026-12-25"
]);

/* ================= UTC UTIL (NO TIMEZONE SHIFT) ================= */

const pad=n=>String(n).padStart(2,"0");
function makeUTC(y,m,d){ return new Date(Date.UTC(y,m,d)); }
function isoUTC(d){ return `${d.getUTCFullYear()}-${pad(d.getUTCMonth()+1)}-${pad(d.getUTCDate())}`; }
function addDaysUTC(d,n){ return new Date(d.getTime()+n*86400000); }
function dowUTC(d){ return d.getUTCDay(); } // 0 Sun..6 Sat
function idx(i){ return ((i%LOOP)+LOOP)%LOOP; }

const ANCHOR_UTC_MS = Date.UTC(2026,0,1);

function baseCode(slot, dateUTC){
  const di = Math.floor((dateUTC.getTime() - ANCHOR_UTC_MS) / 86400000);
  return SLOTS[slot][idx(di)];
}

function isWeekendUTC(d){ const w=dowUTC(d); return w===0 || w===6; }
function isWeekdayUTC(d){ const w=dowUTC(d); return w>=1 && w<=5; }
function isDouble(code){ return String(code).includes("/"); }
function isACWork(code){ return code==="A" || code==="C" || isDouble(code); }
function isOff(code){ return code==="RDO" || code==="MDO"; }
function isReserve(code){ return code==="R"; }

function colClassForDow(w){ return w===0?"sunCol":w===6?"satCol":"wkCol"; }

/* contiguous B-run includes weekend? */
function bRunIncludesWeekend(dateUTC, baseMap){
  const di = isoUTC(dateUTC);
  if(baseMap.get(di) !== "B") return false;

  let s = dateUTC;
  for(let i=0;i<14;i++){
    const p = addDaysUTC(s, -1);
    if(baseMap.get(isoUTC(p)) !== "B") break;
    s = p;
  }
  let e = dateUTC;
  for(let i=0;i<14;i++){
    const n = addDaysUTC(e, 1);
    if(baseMap.get(isoUTC(n)) !== "B") break;
    e = n;
  }
  for(let cur=s; cur.getTime()<=e.getTime(); cur=addDaysUTC(cur,1)){
    const w = dowUTC(cur);
    if(w===0 || w===6) return true;
  }
  return false;
}

/* ================= HOLIDAY LOGIC =================
We ALWAYS show holidays in the HEADER (HOL markers).
For PEOPLE cells:
- "HOL" shows when the person is OFF (or credited HOL day)
- If they WORK the holiday, the cell stays A/B/C/etc and they get credit later.
*/
function computeDisplay(rangeStartUTC, rangeEndUTC){
  const baseMapByPerson = new Map();
  for(const p of PEOPLE){
    const m=new Map();
    for(let d=rangeStartUTC; d.getTime()<=rangeEndUTC.getTime(); d=addDaysUTC(d,1)){
      m.set(isoUTC(d), baseCode(p.s, d));
    }
    baseMapByPerson.set(p.n, m);
  }

  const holOnDate = new Map();
  const credits   = new Map();
  for(const p of PEOPLE){
    holOnDate.set(p.n, new Set());
    credits.set(p.n, 0);
  }

  function placeCredit(name, fromISO){
    const baseM = baseMapByPerson.get(name);
    const holS  = holOnDate.get(name);

    let d = addDaysUTC(new Date(fromISO+"T00:00:00Z"), 1);
    for(let i=0;i<260;i++){
      const di=isoUTC(d);
      const code=baseM.get(di)||"";
      if(HOLIDAYS_2026.has(di)) { d = addDaysUTC(d,1); continue; } // never place on a holiday date
      if(isWeekdayUTC(d) && code==="B" && !holS.has(di)){
        holS.add(di);
        return true;
      }
      d = addDaysUTC(d,1);
    }
    return false;
  }

  function pickBWorkers(holidayDateUTC){
    const hISO = isoUTC(holidayDateUTC);
    const dow = dowUTC(holidayDateUTC);
    const candidates = PEOPLE.filter(p => baseMapByPerson.get(p.n).get(hISO)==="B");

    if(isWeekendUTC(holidayDateUTC)){
      return new Set(candidates.map(p=>p.n)); // weekend holiday: base-B covers
    }

    const wantWeekendGroup = (dow===1 || dow===2 || dow===4 || dow===5); // Mon Tue Thu Fri -> Thu–Tue group
    const wantWeekGroup    = (dow===3); // Wed -> Mon–Fri group

    const match=[], other=[];
    for(const p of candidates){
      const incWeekend = bRunIncludesWeekend(holidayDateUTC, baseMapByPerson.get(p.n));
      if(wantWeekGroup){
        (incWeekend ? other : match).push(p);
      } else if(wantWeekendGroup){
        (incWeekend ? match : other).push(p);
      } else {
        match.push(p);
      }
    }

    const sort = arr => arr.slice().sort((a,b)=> (a.s-b.s) || a.n.localeCompare(b.n));
    const pick=[];
    for(const p of sort(match)) if(pick.length<2) pick.push(p);
    for(const p of sort(other)) if(pick.length<2) pick.push(p);
    if(pick.length<2){
      for(const p of sort(candidates)){
        if(pick.some(x=>x.n===p.n)) continue;
        pick.push(p);
        if(pick.length===2) break;
      }
    }
    return new Set(pick.map(p=>p.n));
  }

  // holiday list in range
  const holidayISOs=[];
  for(let d=rangeStartUTC; d.getTime()<=rangeEndUTC.getTime(); d=addDaysUTC(d,1)){
    const di=isoUTC(d);
    if(HOLIDAYS_2026.has(di)) holidayISOs.push(di);
  }

  for(const hISO of holidayISOs){
    const hDateUTC = new Date(hISO+"T00:00:00Z");
    const bWorkers = pickBWorkers(hDateUTC);

    for(const p of PEOPLE){
      const code = baseMapByPerson.get(p.n).get(hISO) || "";

      if(isReserve(code)){
        holOnDate.get(p.n).add(hISO);      // R never works holiday -> HOL that day
        continue;
      }
      if(isOff(code)){
        credits.set(p.n, credits.get(p.n)+1);
        continue;
      }
      if(isACWork(code)){
        credits.set(p.n, credits.get(p.n)+1);
        continue;
      }
      if(code==="B"){
        if(bWorkers.has(p.n)){
          credits.set(p.n, credits.get(p.n)+1); // works holiday
        } else {
          holOnDate.get(p.n).add(hISO);         // off holiday
        }
        continue;
      }
      credits.set(p.n, credits.get(p.n)+1);
    }

    // place credits after this holiday
    for(const p of PEOPLE){
      let c = credits.get(p.n);
      while(c>0){
        const placed = placeCredit(p.n, hISO);
        if(!placed) break;
        c--;
      }
      credits.set(p.n, c);
    }
  }

  const displayByPerson = new Map();
  for(const p of PEOPLE){
    const baseM = baseMapByPerson.get(p.n);
    const holS  = holOnDate.get(p.n);
    const disp  = new Map();
    for(let d=rangeStartUTC; d.getTime()<=rangeEndUTC.getTime(); d=addDaysUTC(d,1)){
      const di=isoUTC(d);
      disp.set(di, holS.has(di) ? "HOL" : (baseM.get(di)||""));
    }
    displayByPerson.set(p.n, disp);
  }

  return { baseMapByPerson, displayByPerson };
}

/* ================= RENDER ================= */

const wrap=document.getElementById("wrap");
const startMonthEl=document.getElementById("startMonth");

function currentMonthUTC(){
  const now = new Date();
  return makeUTC(now.getUTCFullYear(), now.getUTCMonth(), 1);
}

let startUTC = currentMonthUTC(); // ALWAYS start from current month

function setMonthInput(){
  startMonthEl.value = `${startUTC.getUTCFullYear()}-${pad(startUTC.getUTCMonth()+1)}`;
}

function enableRowSelection(){
  document.querySelectorAll("td.name").forEach(cell=>{
    cell.onclick=()=>{
      document.querySelectorAll("tr.selected").forEach(r=>r.classList.remove("selected"));
      cell.closest("tr").classList.add("selected");
    };
  });
}

function render(){
  wrap.innerHTML="";
  const months=+document.getElementById("showMonths").value;

  const rangeStartUTC = makeUTC(startUTC.getUTCFullYear(), startUTC.getUTCMonth(), 1);
  const rangeEndUTC   = addDaysUTC(makeUTC(startUTC.getUTCFullYear(), startUTC.getUTCMonth()+12, 1), 260);

  const computed = computeDisplay(rangeStartUTC, rangeEndUTC);

  for(let i=0;i<months;i++){
    const monthUTC = makeUTC(startUTC.getUTCFullYear(), startUTC.getUTCMonth()+i, 1);
    const y = monthUTC.getUTCFullYear();
    const m = monthUTC.getUTCMonth();
    const daysInMonth = makeUTC(y, m+1, 0).getUTCDate();

    const panel=document.createElement("div");
    panel.className="panel";

    const header=document.createElement("div");
    header.className="monthHeader";
    header.textContent = `${monthUTC.toLocaleString("default",{month:"long", timeZone:"UTC"})} ${y}`;
    panel.appendChild(header);

    const sc=document.createElement("div");
    sc.className="scroll";

    const t=document.createElement("table");

    // day numbers (header row 1)
    let tr=document.createElement("tr");
    tr.className="hdrRow";
    tr.innerHTML = `<th class="name">NAME</th>`;
    for(let day=1; day<=daysInMonth; day++){
      tr.innerHTML += `<th>${day}</th>`;
    }
    t.appendChild(tr);

    // day-of-week (header row 2)
    tr=document.createElement("tr");
    tr.className="hdrRow";
    tr.innerHTML = `<th class="name"></th>`;
    const dows=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
    for(let day=1; day<=daysInMonth; day++){
      const dt = makeUTC(y,m,day);
      tr.innerHTML += `<th>${dows[dowUTC(dt)]}</th>`;
    }
    t.appendChild(tr);

    // HOL markers (header row 3)  <-- THIS MAKES HOLIDAYS ALWAYS VISIBLE
    tr=document.createElement("tr");
    tr.className="hdrRow";
    tr.innerHTML = `<th class="name"></th>`;
    for(let day=1; day<=daysInMonth; day++){
      const dt = makeUTC(y,m,day);
      const di = isoUTC(dt);
      if(HOLIDAYS_2026.has(di)){
        tr.innerHTML += `<th class="holHead">HOL</th>`;
      } else {
        tr.innerHTML += `<th></th>`;
      }
    }
    t.appendChild(tr);

    // people rows
    PEOPLE.forEach((ppl, pi)=>{
      const r=document.createElement("tr");
      r.className = (pi%2===0) ? "r2" : "r1";
      r.innerHTML = `<td class="name">${ppl.n}</td>`;

      const dispM = computed.displayByPerson.get(ppl.n);
      const baseM = computed.baseMapByPerson.get(ppl.n);

      for(let day=1; day<=daysInMonth; day++){
        const dt = makeUTC(y,m,day);
        const di = isoUTC(dt);

        const td=document.createElement("td");
        td.className = colClassForDow(dowUTC(dt));

        const base = baseM.get(di) || "";
        const display = dispM.get(di) || base;

        if(display==="HOL"){
          td.classList.add("hol");
          td.textContent="HOL";
        } else {
          td.textContent=base; // keep A/B/C shown for workers on the holiday
        }

        r.appendChild(td);
      }

      t.appendChild(r);
    });

    sc.appendChild(t);
    panel.appendChild(sc);
    wrap.appendChild(panel);
  }

  enableRowSelection();
}

/* ================= CONTROLS ================= */

document.getElementById("showMonths").addEventListener("change", ()=>{ setMonthInput(); render(); });

document.getElementById("prev").addEventListener("click", ()=>{
  startUTC = makeUTC(startUTC.getUTCFullYear(), startUTC.getUTCMonth()-1, 1);
  setMonthInput();
  render();
});

document.getElementById("next").addEventListener("click", ()=>{
  startUTC = makeUTC(startUTC.getUTCFullYear(), startUTC.getUTCMonth()+1, 1);
  setMonthInput();
  render();
});

document.getElementById("today").addEventListener("click", ()=>{
  startUTC = currentMonthUTC();
  setMonthInput();
  render();
});

startMonthEl.addEventListener("change", (e)=>{
  const [yy,mm] = e.target.value.split("-").map(Number);
  startUTC = makeUTC(yy, mm-1, 1);
  setMonthInput();
  render();
});

/* init */
setMonthInput();
render();
</script>
</body>
</html>
